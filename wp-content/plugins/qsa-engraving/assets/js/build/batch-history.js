(()=>{"use strict";var e,a={94(){const e=window.React,a=window.wp.element,s=window.wp.i18n;function t({batches:a,selectedBatchId:t,onSelectBatch:n,pagination:l,onPageChange:c,loading:r}){return 0!==a.length||r?(0,e.createElement)("div",{className:"qsa-batch-list"},(0,e.createElement)("div",{className:"qsa-batch-list-header"},(0,e.createElement)("span",{className:"dashicons dashicons-archive"}),(0,e.createElement)("span",{className:"qsa-batch-list-title"},(0,s.__)("Completed Batches","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-count"},"(",l.total,")"),r&&(0,e.createElement)("span",{className:"spinner is-active"})),(0,e.createElement)("div",{className:"qsa-batch-list-items"},a.map(a=>{const l=t===a.id;return(0,e.createElement)("div",{key:a.id,onClick:()=>n(a.id),className:"qsa-batch-item "+(l?"selected":""),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n(a.id))}},(0,e.createElement)("div",{className:"qsa-batch-item-header"},(0,e.createElement)("div",{className:"qsa-batch-id"},(0,e.createElement)("span",{className:"batch-label"},(0,s.__)("Batch","qsa-engraving")),(0,e.createElement)("span",{className:"batch-number"},"#",a.id)),(0,e.createElement)("span",{className:"qsa-batch-status completed"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,s.__)("Completed","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-time"},function(e){if(!e)return"";const a=new Date(e),t=new Date-a,n=Math.floor(t/864e5);return 0===n?(0,s.__)("Today","qsa-engraving"):1===n?(0,s.__)("Yesterday","qsa-engraving"):n<7?n+" "+(0,s.__)("days ago","qsa-engraving"):n<30?Math.floor(n/7)+" "+(0,s.__)("weeks ago","qsa-engraving"):Math.floor(n/30)+" "+(0,s.__)("months ago","qsa-engraving")}(a.completed_at))),(0,e.createElement)("div",{className:"qsa-batch-stats"},(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-products"}),a.module_count," ",(0,s.__)("modules","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-grid-view"}),a.qsa_count," ",(0,s.__)("arrays","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-cart"}),a.order_ids.length>2?a.order_ids.slice(0,2).join(", ")+" +"+(a.order_ids.length-2):a.order_ids.join(", "))),(0,e.createElement)("div",{className:"qsa-batch-types"},a.module_types.map(a=>(0,e.createElement)("span",{key:a,className:"qsa-type-badge"},a))))})),l.total_pages<=1?null:(0,e.createElement)("div",{className:"qsa-pagination"},(0,e.createElement)("button",{onClick:()=>c(l.page-1),disabled:l.page<=1||r,className:"qsa-pagination-btn"},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-left-alt2"})),(0,e.createElement)("span",{className:"qsa-pagination-info"},l.page," / ",l.total_pages),(0,e.createElement)("button",{onClick:()=>c(l.page+1),disabled:l.page>=l.total_pages||r,className:"qsa-pagination-btn"},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt2"})))):(0,e.createElement)("div",{className:"qsa-batch-list"},(0,e.createElement)("div",{className:"qsa-batch-list-header"},(0,e.createElement)("span",{className:"dashicons dashicons-archive"}),(0,e.createElement)("span",{className:"qsa-batch-list-title"},(0,s.__)("Completed Batches","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-count"},"(0)")),(0,e.createElement)("div",{className:"qsa-batch-list-empty"},(0,e.createElement)("span",{className:"dashicons dashicons-info"}),(0,e.createElement)("p",null,(0,s.__)("No completed batches found matching your criteria.","qsa-engraving"))))}function n(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function l({batch:a,loading:t,error:l,onLoadForReengraving:c,duplicating:r}){return t?(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,e.createElement)("p",null,(0,s.__)("Loading batch details...","qsa-engraving")))):l?(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-error"},(0,e.createElement)("span",{className:"dashicons dashicons-warning",style:{color:"#d63638"}}),(0,e.createElement)("p",{style:{color:"#d63638"}},l))):a?(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-card"},(0,e.createElement)("div",{className:"qsa-card-header"},(0,e.createElement)("span",{className:"qsa-batch-number"},(0,s.__)("Batch","qsa-engraving")," #",a.id),(0,e.createElement)("span",{className:"qsa-batch-status completed"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,s.__)("Completed","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-card-info"},(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Created:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},n(a.created_at))),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Completed:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},n(a.completed_at))),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Total Arrays:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},a.qsa_count)),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Orders:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},a.order_ids.map((a,s)=>(0,e.createElement)("span",{key:a},s>0&&", ",(0,e.createElement)("a",{href:`${window.qsaEngraving?.adminUrl||"/wp-admin/"}post.php?post=${a}&action=edit`,className:"qsa-link",target:"_blank",rel:"noopener noreferrer"},a))))))),(0,e.createElement)("div",{className:"qsa-modules-section"},(0,e.createElement)("div",{className:"qsa-modules-header"},(0,e.createElement)("span",{className:"qsa-modules-title"},(0,s.__)("Modules in Batch","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-modules-count"},"(",a.module_count,")")),(0,e.createElement)("div",{className:"qsa-modules-list"},a.modules&&a.modules.map((a,t)=>(0,e.createElement)("div",{key:t,className:"qsa-module-item"},(0,e.createElement)("div",{className:"qsa-module-main"},(0,e.createElement)("a",{href:`${window.qsaEngraving?.adminUrl||"/wp-admin/"}edit.php?post_type=product&s=${encodeURIComponent(a.module_sku)}`,className:"qsa-module-sku qsa-link",target:"_blank",rel:"noopener noreferrer"},a.module_sku),(0,e.createElement)("span",{className:"qsa-module-qty"},"Ã— ",a.qty)),(0,e.createElement)("div",{className:"qsa-module-meta"},(0,e.createElement)("span",{className:"qsa-serial-range"},a.serial_start," - ",a.serial_end),(0,e.createElement)("a",{href:`${window.qsaEngraving?.adminUrl||"/wp-admin/"}post.php?post=${a.order_id}&action=edit`,className:"qsa-order-id qsa-link",target:"_blank",rel:"noopener noreferrer"},(0,s.__)("Order","qsa-engraving")," #",a.order_id)))))),a.module_details&&a.module_details.length>0&&(0,e.createElement)("div",{className:"qsa-module-details-section"},(0,e.createElement)("details",{className:"qsa-module-details-expandable"},(0,e.createElement)("summary",{className:"qsa-module-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-editor-table"}),(0,e.createElement)("span",{className:"qsa-module-details-title"},(0,s.__)("QSA Positions & Serial Numbers","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-module-details-grid"},(0,e.createElement)("div",{className:"qsa-details-table-header"},(0,e.createElement)("span",{className:"qsa-col-serial"},(0,s.__)("Serial","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-col-sku"},(0,s.__)("Module","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-col-order"},(0,s.__)("Order","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-col-qsa"},(0,s.__)("QSA","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-col-pos"},(0,s.__)("Pos","qsa-engraving"))),a.module_details.map(a=>(0,e.createElement)("div",{key:a.id,className:"qsa-details-table-row"},(0,e.createElement)("span",{className:"qsa-col-serial qsa-monospace"},a.serial_number),(0,e.createElement)("a",{href:`${window.qsaEngraving?.adminUrl||"/wp-admin/"}edit.php?post_type=product&s=${encodeURIComponent(a.module_sku)}`,className:"qsa-col-sku qsa-link",target:"_blank",rel:"noopener noreferrer"},a.module_sku),(0,e.createElement)("a",{href:`${window.qsaEngraving?.adminUrl||"/wp-admin/"}post.php?post=${a.order_id}&action=edit`,className:"qsa-col-order qsa-link",target:"_blank",rel:"noopener noreferrer"},"#",a.order_id),(0,e.createElement)("span",{className:"qsa-col-qsa"},a.qsa_sequence),(0,e.createElement)("span",{className:"qsa-col-pos"},a.array_position)))))),(0,e.createElement)("div",{className:"qsa-details-actions"},(0,e.createElement)("button",{onClick:c,className:"qsa-load-button",disabled:r},r?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"spinner is-active"}),(0,s.__)("Duplicating...","qsa-engraving")):(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"dashicons dashicons-update"}),(0,s.__)("Load for Re-engraving","qsa-engraving")))),(0,e.createElement)("p",{className:"qsa-details-help"},(0,s.__)("This will create a duplicate batch with the same modules, assigning new serial numbers for re-engraving.","qsa-engraving"))):(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-empty"},(0,e.createElement)("span",{className:"dashicons dashicons-info"}),(0,e.createElement)("p",null,(0,s.__)("Select a batch to view details","qsa-engraving"))))}const c=[{value:"all",label:(0,s.__)("All Types","qsa-engraving")},{value:"CORE",label:"CORE"},{value:"SOLO",label:"SOLO"},{value:"EDGE",label:"EDGE"},{value:"STAR",label:"STAR"}];function r({filters:t,onFilterChange:n,loading:l}){const[r,i]=(0,a.useState)(t.search),[o,m]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{const e=setTimeout(()=>{r!==t.search&&n({...t,search:r})},500);return()=>clearTimeout(e)},[r]),(0,e.createElement)("div",{className:"qsa-search-filter"},(0,e.createElement)("div",{className:"qsa-search-bar"},(0,e.createElement)("div",{className:"qsa-search-input-wrapper"},(0,e.createElement)("input",{type:"text",placeholder:(0,s.__)("Search by batch ID, order ID, or module SKU...","qsa-engraving"),value:r,onChange:e=>{i(e.target.value)},className:"qsa-search-input",disabled:l}),r?(0,e.createElement)("button",{onClick:()=>{i(""),n({...t,search:""})},className:"qsa-search-clear",title:(0,s.__)("Clear search","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-no-alt"})):(0,e.createElement)("span",{className:"dashicons dashicons-search qsa-search-icon"})),(0,e.createElement)("button",{onClick:()=>m(!o),className:"qsa-filter-toggle "+(o?"active":"")},(0,e.createElement)("span",{className:"dashicons dashicons-filter"}),(0,s.__)("Filters","qsa-engraving"))),o&&(0,e.createElement)("div",{className:"qsa-filter-options"},(0,e.createElement)("span",{className:"qsa-filter-label"},(0,s.__)("Module Type:","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-filter-buttons"},c.map(a=>(0,e.createElement)("button",{key:a.value,onClick:()=>(e=>{n({...t,filterType:e})})(a.value),className:"qsa-filter-button "+(t.filterType===a.value?"active":""),disabled:l},a.label)))))}function i(){const[n,c]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),[m,d]=(0,a.useState)(null),[p,g]=(0,a.useState)(!0),[h,q]=(0,a.useState)(!1),[u,E]=(0,a.useState)(null),[v,_]=(0,a.useState)(null),[N,b]=(0,a.useState)({page:1,per_page:20,total:0,total_pages:0}),[w,f]=(0,a.useState)({search:"",filterType:"all"}),[y,k]=(0,a.useState)(!1),S=(0,a.useCallback)(async()=>{g(!0),E(null);try{const e=new FormData;e.append("action","qsa_get_batch_history"),e.append("nonce",window.qsaEngraving?.nonce||""),e.append("page",N.page),e.append("per_page",N.per_page),e.append("search",w.search),e.append("filter_type",w.filterType),e.append("status","completed");const a=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}),t=await a.json();t.success?(c(t.data.batches),b(e=>({...e,...t.data.pagination}))):E(t.data?.message||(0,s.__)("Failed to load batch history.","qsa-engraving"))}catch(e){E((0,s.__)("Network error loading batch history.","qsa-engraving"))}g(!1)},[N.page,N.per_page,w.search,w.filterType]);(0,a.useEffect)(()=>{S()},[S]);const C=(0,a.useCallback)(async e=>{if(!e)return d(null),void _(null);q(!0),_(null);try{const a=new FormData;a.append("action","qsa_get_batch_details"),a.append("nonce",window.qsaEngraving?.nonce||""),a.append("batch_id",e);const t=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:a}),n=await t.json();n.success?d(n.data.batch):(d(null),_(n.data?.message||(0,s.__)("Failed to load batch details.","qsa-engraving")))}catch(e){d(null),_((0,s.__)("Network error loading batch details.","qsa-engraving"))}q(!1)},[]);return(0,a.useEffect)(()=>{C(i)},[i,C]),p&&0===n.length?(0,e.createElement)("div",{className:"qsa-history-loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,e.createElement)("p",null,(0,s.__)("Loading batch history...","qsa-engraving"))):u&&0===n.length?(0,e.createElement)("div",{className:"qsa-history-error"},(0,e.createElement)("div",{className:"notice notice-error"},(0,e.createElement)("p",null,u)),(0,e.createElement)("button",{onClick:S,className:"button"},(0,s.__)("Retry","qsa-engraving"))):(0,e.createElement)("div",{className:"qsa-batch-history"},(0,e.createElement)("div",{className:"qsa-history-header"},(0,e.createElement)("button",{onClick:()=>{const e=new URL(window.location.href);e.searchParams.set("page","qsa-engraving"),e.searchParams.delete("source"),e.searchParams.delete("source_batch_id"),window.location.href=e.toString()},className:"qsa-back-button",title:(0,s.__)("Back to Dashboard","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-left-alt"})),(0,e.createElement)("div",{className:"qsa-history-title"},(0,e.createElement)("div",{className:"qsa-history-title-icon"},(0,e.createElement)("span",{className:"dashicons dashicons-backup"})),(0,e.createElement)("div",null,(0,e.createElement)("h2",null,(0,s.__)("Engraving Batch History","qsa-engraving")),(0,e.createElement)("p",{className:"qsa-history-subtitle"},(0,s.__)("View and reload previous batches for re-engraving","qsa-engraving"))))),(0,e.createElement)(r,{filters:w,onFilterChange:e=>{f(e),b(e=>({...e,page:1})),o(null),d(null)},loading:p}),(0,e.createElement)("div",{className:"qsa-history-content"},(0,e.createElement)("div",{className:"qsa-history-list-panel"},(0,e.createElement)(t,{batches:n,selectedBatchId:i,onSelectBatch:e=>{o(e)},pagination:N,onPageChange:e=>{b(a=>({...a,page:e})),o(null),d(null)},loading:p})),(0,e.createElement)("div",{className:"qsa-history-details-panel"},(0,e.createElement)(l,{batch:m,loading:h,error:v,onLoadForReengraving:async()=>{if(m&&!y){k(!0),E(null);try{const e=new FormData;e.append("action","qsa_duplicate_batch"),e.append("nonce",window.qsaEngraving?.nonce||""),e.append("source_batch_id",m.id);const a=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}),t=await a.json();t.success?window.location.href=t.data.redirect_url:(E(t.data?.message||(0,s.__)("Failed to duplicate batch.","qsa-engraving")),k(!1))}catch(e){E((0,s.__)("Network error duplicating batch.","qsa-engraving")),k(!1)}}},duplicating:y}))),(0,e.createElement)("div",{className:"qsa-history-legend"},(0,e.createElement)("span",{className:"qsa-legend-title"},(0,s.__)("Re-engraving Workflow:","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-legend-steps"},(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"1"),(0,s.__)("Select batch","qsa-engraving")),(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt"}),(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"2"),(0,s.__)('Click "Load for Re-engraving"',"qsa-engraving")),(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt"}),(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"3"),(0,s.__)("New batch created with new serials","qsa-engraving")))))}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("qsa-engraving-batch-history");s&&(0,a.createRoot)(s).render((0,e.createElement)(i,null))})}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var l=s[e]={exports:{}};return a[e](l,l.exports,t),l.exports}t.m=a,e=[],t.O=(a,s,n,l)=>{if(!s){var c=1/0;for(m=0;m<e.length;m++){for(var[s,n,l]=e[m],r=!0,i=0;i<s.length;i++)(!1&l||c>=l)&&Object.keys(t.O).every(e=>t.O[e](s[i]))?s.splice(i--,1):(r=!1,l<c&&(c=l));if(r){e.splice(m--,1);var o=n();void 0!==o&&(a=o)}}return a}l=l||0;for(var m=e.length;m>0&&e[m-1][2]>l;m--)e[m]=e[m-1];e[m]=[s,n,l]},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={878:0,501:0};t.O.j=a=>0===e[a];var a=(a,s)=>{var n,l,[c,r,i]=s,o=0;if(c.some(a=>0!==e[a])){for(n in r)t.o(r,n)&&(t.m[n]=r[n]);if(i)var m=i(t)}for(a&&a(s);o<c.length;o++)l=c[o],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(m)},s=globalThis.webpackChunkqsa_engraving=globalThis.webpackChunkqsa_engraving||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))})();var n=t.O(void 0,[501],()=>t(94));n=t.O(n)})();