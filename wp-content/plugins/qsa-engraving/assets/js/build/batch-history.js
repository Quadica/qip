(()=>{"use strict";var e,a={94(){const e=window.React,a=window.wp.element,s=window.wp.i18n;function t({batches:a,selectedBatchId:t,onSelectBatch:n,pagination:l,onPageChange:c,loading:r}){return 0!==a.length||r?(0,e.createElement)("div",{className:"qsa-batch-list"},(0,e.createElement)("div",{className:"qsa-batch-list-header"},(0,e.createElement)("span",{className:"dashicons dashicons-archive"}),(0,e.createElement)("span",{className:"qsa-batch-list-title"},(0,s.__)("Completed Batches","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-count"},"(",l.total,")"),r&&(0,e.createElement)("span",{className:"spinner is-active"})),(0,e.createElement)("div",{className:"qsa-batch-list-items"},a.map(a=>{const l=t===a.id;return(0,e.createElement)("div",{key:a.id,onClick:()=>n(a.id),className:"qsa-batch-item "+(l?"selected":""),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n(a.id))}},(0,e.createElement)("div",{className:"qsa-batch-item-header"},(0,e.createElement)("div",{className:"qsa-batch-id"},(0,e.createElement)("span",{className:"batch-label"},(0,s.__)("Batch","qsa-engraving")),(0,e.createElement)("span",{className:"batch-number"},"#",a.id)),(0,e.createElement)("span",{className:"qsa-batch-status completed"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,s.__)("Completed","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-time"},function(e){if(!e)return"";const a=new Date(e),t=new Date-a,n=Math.floor(t/864e5);return 0===n?(0,s.__)("Today","qsa-engraving"):1===n?(0,s.__)("Yesterday","qsa-engraving"):n<7?n+" "+(0,s.__)("days ago","qsa-engraving"):n<30?Math.floor(n/7)+" "+(0,s.__)("weeks ago","qsa-engraving"):Math.floor(n/30)+" "+(0,s.__)("months ago","qsa-engraving")}(a.completed_at))),(0,e.createElement)("div",{className:"qsa-batch-stats"},(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-products"}),a.module_count," ",(0,s.__)("modules","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-grid-view"}),a.qsa_count," ",(0,s.__)("arrays","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-stat"},(0,e.createElement)("span",{className:"dashicons dashicons-cart"}),a.order_ids.length>2?a.order_ids.slice(0,2).join(", ")+" +"+(a.order_ids.length-2):a.order_ids.join(", "))),(0,e.createElement)("div",{className:"qsa-batch-types"},a.module_types.map(a=>(0,e.createElement)("span",{key:a,className:"qsa-type-badge"},a))))})),l.total_pages<=1?null:(0,e.createElement)("div",{className:"qsa-pagination"},(0,e.createElement)("button",{onClick:()=>c(l.page-1),disabled:l.page<=1||r,className:"qsa-pagination-btn"},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-left-alt2"})),(0,e.createElement)("span",{className:"qsa-pagination-info"},l.page," / ",l.total_pages),(0,e.createElement)("button",{onClick:()=>c(l.page+1),disabled:l.page>=l.total_pages||r,className:"qsa-pagination-btn"},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt2"})))):(0,e.createElement)("div",{className:"qsa-batch-list"},(0,e.createElement)("div",{className:"qsa-batch-list-header"},(0,e.createElement)("span",{className:"dashicons dashicons-archive"}),(0,e.createElement)("span",{className:"qsa-batch-list-title"},(0,s.__)("Completed Batches","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-batch-count"},"(0)")),(0,e.createElement)("div",{className:"qsa-batch-list-empty"},(0,e.createElement)("span",{className:"dashicons dashicons-info"}),(0,e.createElement)("p",null,(0,s.__)("No completed batches found matching your criteria.","qsa-engraving"))))}function n(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function l({batch:a,loading:t,onLoadForReengraving:l}){return t?(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,e.createElement)("p",null,(0,s.__)("Loading batch details...","qsa-engraving")))):a?(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-card"},(0,e.createElement)("div",{className:"qsa-card-header"},(0,e.createElement)("span",{className:"qsa-batch-number"},(0,s.__)("Batch","qsa-engraving")," #",a.id),(0,e.createElement)("span",{className:"qsa-batch-status completed"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,s.__)("Completed","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-card-info"},(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Created:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},n(a.created_at))),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Completed:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},n(a.completed_at))),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Total Arrays:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},a.qsa_count)),(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Orders:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},a.order_ids.join(", "))),a.created_by_name&&(0,e.createElement)("div",{className:"qsa-info-row"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Created by:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},a.created_by_name)))),(0,e.createElement)("div",{className:"qsa-modules-section"},(0,e.createElement)("div",{className:"qsa-modules-header"},(0,e.createElement)("span",{className:"qsa-modules-title"},(0,s.__)("Modules in Batch","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-modules-count"},"(",a.module_count,")")),(0,e.createElement)("div",{className:"qsa-modules-list"},a.modules&&a.modules.map((a,t)=>(0,e.createElement)("div",{key:t,className:"qsa-module-item"},(0,e.createElement)("div",{className:"qsa-module-main"},(0,e.createElement)("span",{className:"qsa-module-sku"},a.module_sku),(0,e.createElement)("span",{className:"qsa-module-qty"},"Ã— ",a.qty)),(0,e.createElement)("div",{className:"qsa-module-meta"},(0,e.createElement)("span",{className:"qsa-serial-range"},a.serial_start," - ",a.serial_end),(0,e.createElement)("span",{className:"qsa-order-id"},(0,s.__)("Order","qsa-engraving")," #",a.order_id)))))),(0,e.createElement)("div",{className:"qsa-details-actions"},(0,e.createElement)("button",{onClick:l,className:"qsa-load-button"},(0,e.createElement)("span",{className:"dashicons dashicons-update"}),(0,s.__)("Load for Re-engraving","qsa-engraving"))),(0,e.createElement)("p",{className:"qsa-details-help"},(0,s.__)("Loading this batch will display all modules in the Batch Creator, where you can select specific modules to re-engrave with new serial numbers.","qsa-engraving"))):(0,e.createElement)("div",{className:"qsa-batch-details"},(0,e.createElement)("div",{className:"qsa-details-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-details-title"},(0,s.__)("Batch Details","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-details-empty"},(0,e.createElement)("span",{className:"dashicons dashicons-info"}),(0,e.createElement)("p",null,(0,s.__)("Select a batch to view details","qsa-engraving"))))}const c=[{value:"all",label:(0,s.__)("All Types","qsa-engraving")},{value:"CORE",label:"CORE"},{value:"SOLO",label:"SOLO"},{value:"EDGE",label:"EDGE"},{value:"STAR",label:"STAR"}];function r({filters:t,onFilterChange:n,loading:l}){const[r,i]=(0,a.useState)(t.search),[m,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{const e=setTimeout(()=>{r!==t.search&&n({...t,search:r})},300);return()=>clearTimeout(e)},[r]),(0,e.createElement)("div",{className:"qsa-search-filter"},(0,e.createElement)("div",{className:"qsa-search-bar"},(0,e.createElement)("div",{className:"qsa-search-input-wrapper"},(0,e.createElement)("span",{className:"dashicons dashicons-search"}),(0,e.createElement)("input",{type:"text",placeholder:(0,s.__)("Search by batch ID, order ID, or module SKU...","qsa-engraving"),value:r,onChange:e=>{i(e.target.value)},className:"qsa-search-input",disabled:l}),r&&(0,e.createElement)("button",{onClick:()=>{i(""),n({...t,search:""})},className:"qsa-search-clear",title:(0,s.__)("Clear search","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-no-alt"}))),(0,e.createElement)("button",{onClick:()=>o(!m),className:"qsa-filter-toggle "+(m?"active":"")},(0,e.createElement)("span",{className:"dashicons dashicons-filter"}),(0,s.__)("Filters","qsa-engraving"))),m&&(0,e.createElement)("div",{className:"qsa-filter-options"},(0,e.createElement)("span",{className:"qsa-filter-label"},(0,s.__)("Module Type:","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-filter-buttons"},c.map(a=>(0,e.createElement)("button",{key:a.value,onClick:()=>(e=>{n({...t,filterType:e})})(a.value),className:"qsa-filter-button "+(t.filterType===a.value?"active":""),disabled:l},a.label)))))}function i(){const[n,c]=(0,a.useState)([]),[i,m]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[h,g]=(0,a.useState)(!0),[p,E]=(0,a.useState)(!1),[q,u]=(0,a.useState)(null),[v,N]=(0,a.useState)({page:1,per_page:20,total:0,total_pages:0}),[_,b]=(0,a.useState)({search:"",filterType:"all"}),f=(0,a.useCallback)(async()=>{g(!0),u(null);try{const e=new FormData;e.append("action","qsa_get_batch_history"),e.append("nonce",window.qsaEngraving?.nonce||""),e.append("page",v.page),e.append("per_page",v.per_page),e.append("search",_.search),e.append("filter_type",_.filterType),e.append("status","completed");const a=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}),t=await a.json();t.success?(c(t.data.batches),N(e=>({...e,...t.data.pagination}))):u(t.data?.message||(0,s.__)("Failed to load batch history.","qsa-engraving"))}catch(e){u((0,s.__)("Network error loading batch history.","qsa-engraving"))}g(!1)},[v.page,v.per_page,_.search,_.filterType]);(0,a.useEffect)(()=>{f()},[f]);const y=(0,a.useCallback)(async e=>{if(e){E(!0);try{const a=new FormData;a.append("action","qsa_get_batch_details"),a.append("nonce",window.qsaEngraving?.nonce||""),a.append("batch_id",e);const s=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:a}),t=await s.json();t.success?d(t.data.batch):d(null)}catch(e){d(null)}E(!1)}else d(null)},[]);return(0,a.useEffect)(()=>{y(i)},[i,y]),h&&0===n.length?(0,e.createElement)("div",{className:"qsa-history-loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,e.createElement)("p",null,(0,s.__)("Loading batch history...","qsa-engraving"))):q&&0===n.length?(0,e.createElement)("div",{className:"qsa-history-error"},(0,e.createElement)("div",{className:"notice notice-error"},(0,e.createElement)("p",null,q)),(0,e.createElement)("button",{onClick:f,className:"button"},(0,s.__)("Retry","qsa-engraving"))):(0,e.createElement)("div",{className:"qsa-batch-history"},(0,e.createElement)("div",{className:"qsa-history-header"},(0,e.createElement)("button",{onClick:()=>{const e=new URL(window.location.href);e.searchParams.set("page","qsa-engraving-batch-creator"),e.searchParams.delete("source"),e.searchParams.delete("source_batch_id"),window.location.href=e.toString()},className:"qsa-back-button",title:(0,s.__)("Back to Batch Creator","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-left-alt"}),(0,s.__)("Batch Creator","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-history-title"},(0,e.createElement)("span",{className:"dashicons dashicons-backup"}),(0,e.createElement)("h2",null,(0,s.__)("Engraving Batch History","qsa-engraving")))),(0,e.createElement)(r,{filters:_,onFilterChange:e=>{b(e),N(e=>({...e,page:1})),m(null),d(null)},loading:h}),(0,e.createElement)("div",{className:"qsa-history-content"},(0,e.createElement)("div",{className:"qsa-history-list-panel"},(0,e.createElement)(t,{batches:n,selectedBatchId:i,onSelectBatch:e=>{m(e)},pagination:v,onPageChange:e=>{N(a=>({...a,page:e})),m(null),d(null)},loading:h})),(0,e.createElement)("div",{className:"qsa-history-details-panel"},(0,e.createElement)(l,{batch:o,loading:p,onLoadForReengraving:()=>{if(!o)return;const e=new URL(window.location.href);e.searchParams.set("page","qsa-engraving-batch-creator"),e.searchParams.set("source","history"),e.searchParams.set("source_batch_id",o.id),window.location.href=e.toString()}}))),(0,e.createElement)("div",{className:"qsa-history-legend"},(0,e.createElement)("span",{className:"qsa-legend-title"},(0,s.__)("Re-engraving Workflow:","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-legend-steps"},(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"1"),(0,s.__)("Select batch","qsa-engraving")),(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt"}),(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"2"),(0,s.__)("Load into Batch Creator","qsa-engraving")),(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt"}),(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"3"),(0,s.__)("Select modules to re-engrave","qsa-engraving")),(0,e.createElement)("span",{className:"dashicons dashicons-arrow-right-alt"}),(0,e.createElement)("span",{className:"qsa-legend-step"},(0,e.createElement)("span",{className:"step-number"},"4"),(0,s.__)("New serials assigned","qsa-engraving")))))}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("qsa-engraving-batch-history");s&&(0,a.createRoot)(s).render((0,e.createElement)(i,null))})}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var l=s[e]={exports:{}};return a[e](l,l.exports,t),l.exports}t.m=a,e=[],t.O=(a,s,n,l)=>{if(!s){var c=1/0;for(o=0;o<e.length;o++){for(var[s,n,l]=e[o],r=!0,i=0;i<s.length;i++)(!1&l||c>=l)&&Object.keys(t.O).every(e=>t.O[e](s[i]))?s.splice(i--,1):(r=!1,l<c&&(c=l));if(r){e.splice(o--,1);var m=n();void 0!==m&&(a=m)}}return a}l=l||0;for(var o=e.length;o>0&&e[o-1][2]>l;o--)e[o]=e[o-1];e[o]=[s,n,l]},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={878:0,501:0};t.O.j=a=>0===e[a];var a=(a,s)=>{var n,l,[c,r,i]=s,m=0;if(c.some(a=>0!==e[a])){for(n in r)t.o(r,n)&&(t.m[n]=r[n]);if(i)var o=i(t)}for(a&&a(s);m<c.length;m++)l=c[m],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(o)},s=globalThis.webpackChunkqsa_engraving=globalThis.webpackChunkqsa_engraving||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))})();var n=t.O(void 0,[501],()=>t(94));n=t.O(n)})();