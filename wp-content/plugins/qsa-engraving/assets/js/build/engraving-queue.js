(()=>{"use strict";var e,a={601(){const e=window.React,a=window.wp.element,s=window.wp.i18n;function t({batch:a}){const t=window.location.href.replace(/-queue.*/,"-batch-creator");return(0,e.createElement)("div",{className:"qsa-queue-header"},(0,e.createElement)("div",{className:"qsa-queue-header-left"},(0,e.createElement)("a",{href:t,className:"qsa-back-button",title:(0,s.__)("Back to Batch Creator","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-arrow-left-alt2"})),(0,e.createElement)("div",{className:"qsa-queue-header-icon"},(0,e.createElement)("span",{className:"dashicons dashicons-grid-view"})),(0,e.createElement)("div",{className:"qsa-queue-header-text"},(0,e.createElement)("h1",null,(0,s.__)("Engraving Queue","qsa-engraving")),(0,e.createElement)("p",null,a?.batch_name||(0,s.__)("LUXEON STAR LEDs Production System","qsa-engraving")))),(0,e.createElement)("div",{className:"qsa-queue-header-right"},a&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("span",{className:"qsa-batch-id"},(0,s.__)("Batch","qsa-engraving")," #",a.id),(0,e.createElement)("span",{className:`qsa-batch-status status-${a.status}`},"in_progress"===a.status?(0,s.__)("In Progress","qsa-engraving"):(0,s.__)("Completed","qsa-engraving")))))}function n({stats:a,capacity:t}){const n=a.totalItems>0?Math.round(a.completedItems/a.totalItems*100):0;return(0,e.createElement)("div",{className:"qsa-queue-stats"},(0,e.createElement)("div",{className:"qsa-stats-grid"},(0,e.createElement)("div",{className:"qsa-stat-item"},(0,e.createElement)("div",{className:"qsa-stat-label"},(0,s.__)("Queue Items","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-stat-value"},a.totalItems)),(0,e.createElement)("div",{className:"qsa-stat-item"},(0,e.createElement)("div",{className:"qsa-stat-label"},(0,s.__)("Completed","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-stat-value"},(0,e.createElement)("span",{className:"qsa-stat-completed"},a.completedItems),(0,e.createElement)("span",{className:"qsa-stat-separator"},"/"),(0,e.createElement)("span",{className:"qsa-stat-total"},a.totalItems))),(0,e.createElement)("div",{className:"qsa-stat-item"},(0,e.createElement)("div",{className:"qsa-stat-label"},(0,s.__)("Modules","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-stat-value"},(0,e.createElement)("span",{className:"qsa-stat-completed"},a.completedModules),(0,e.createElement)("span",{className:"qsa-stat-separator"},"/"),(0,e.createElement)("span",{className:"qsa-stat-total"},a.totalModules))),(0,e.createElement)("div",{className:"qsa-stat-item"},(0,e.createElement)("div",{className:"qsa-stat-label"},(0,s.__)("Progress","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-stat-value qsa-stat-progress"},n,"%"))),(0,e.createElement)("div",{className:"qsa-progress-bar-container"},(0,e.createElement)("div",{className:"qsa-progress-bar",style:{width:`${n}%`}})),t&&t.warning&&(0,e.createElement)("div",{className:"qsa-capacity-warning "+(t.critical?"critical":"")},(0,e.createElement)("span",{className:"dashicons dashicons-warning"}),(0,e.createElement)("span",null,t.critical?(0,s.__)("Critical: Serial capacity critically low!","qsa-engraving"):(0,s.__)("Warning: Serial capacity running low.","qsa-engraving")," ",t.remaining.toLocaleString()," ",(0,s.__)("remaining","qsa-engraving"))))}function r(e){return e?.padStart(8,"0")||"--------"}function l({item:t,isLast:n,isActive:l,onStart:i,onComplete:c,onRetry:o,onResend:m,onRerun:d,onStartPositionChange:g}){const[u,q]=(0,a.useState)(t.startPosition||1),p=function(e){switch(e){case"complete":return{className:"status-complete",text:(0,s.__)("Complete","qsa-engraving")};case"in_progress":return{className:"status-in-progress",text:(0,s.__)("In Progress","qsa-engraving")};default:return{className:"status-pending",text:(0,s.__)("Pending","qsa-engraving")}}}(t.status),v=(_=t.groupType).includes("Same ID")&&_.includes("Full")?"group-same-full":_.includes("Same ID")&&_.includes("Partial")?"group-same-partial":_.includes("Mixed ID")&&_.includes("Full")?"group-mixed-full":"group-mixed-partial";var _;const E=t.serials&&t.serials.length>0?{start:t.serials[0]?.serial_number,end:t.serials[t.serials.length-1]?.serial_number}:null;return(0,e.createElement)("div",{className:`qsa-queue-item ${"in_progress"===t.status?"is-active":""} ${n?"is-last":""}`},(0,e.createElement)("div",{className:"qsa-queue-item-header"},(0,e.createElement)("div",{className:"qsa-queue-item-left"},(0,e.createElement)("div",{className:`qsa-status-icon ${p.className}`},"complete"===t.status&&(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),"in_progress"===t.status&&(0,e.createElement)("span",{className:"dashicons dashicons-update spin"}),"pending"===t.status&&(0,e.createElement)("span",{className:"dashicons dashicons-clock"})),(0,e.createElement)("span",{className:"qsa-module-type"},t.moduleType),(0,e.createElement)("span",{className:`qsa-group-type ${v}`},t.groupType),(0,e.createElement)("span",{className:`qsa-status-badge ${p.className}`},p.text)),(0,e.createElement)("div",{className:"qsa-queue-item-right"},"pending"===t.status&&(0,e.createElement)("button",{type:"button",className:"button button-primary qsa-btn-start",onClick:()=>i(t.id)},(0,e.createElement)("span",{className:"dashicons dashicons-controls-play"}),(0,s.__)("Engrave","qsa-engraving")),"in_progress"===t.status&&(0,e.createElement)("div",{className:"qsa-action-buttons"},(0,e.createElement)("button",{type:"button",className:"button qsa-btn-resend",onClick:()=>m(t.id),title:(0,s.__)("Resend current SVG to laser (same serials)","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-update"}),(0,s.__)("Resend","qsa-engraving")),(0,e.createElement)("button",{type:"button",className:"button qsa-btn-retry",onClick:()=>o(t.id),title:(0,s.__)("Scrap current QSA and retry with new serials","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-image-rotate"}),(0,s.__)("Retry","qsa-engraving")),(0,e.createElement)("button",{type:"button",className:"button button-primary qsa-btn-complete",onClick:()=>c(t.id)},(0,e.createElement)("span",{className:"dashicons dashicons-yes"}),(0,s.__)("Complete","qsa-engraving"))),"complete"===t.status&&(0,e.createElement)("div",{className:"qsa-action-buttons"},(0,e.createElement)("button",{type:"button",className:"button qsa-btn-rerun",onClick:()=>d(t.id),title:(0,s.__)("Rerun engraving from beginning","qsa-engraving")},(0,e.createElement)("span",{className:"dashicons dashicons-controls-repeat"}),(0,s.__)("Rerun","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-done-badge"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,s.__)("Done","qsa-engraving"))))),(0,e.createElement)("div",{className:"qsa-queue-item-details"},(0,e.createElement)("div",{className:"qsa-detail-group"},(0,e.createElement)("span",{className:"dashicons dashicons-editor-code"}),(0,e.createElement)("span",{className:"qsa-detail-label"},(0,s.__)("Modules:","qsa-engraving")),(0,e.createElement)("div",{className:"qsa-modules-list"},t.modules.map((a,s)=>(0,e.createElement)("span",{key:s,className:"qsa-module-sku"},a.sku," Ã—",a.qty))))),(0,e.createElement)("div",{className:"qsa-queue-item-stats"},(0,e.createElement)("div",{className:"qsa-stat-group"},(0,e.createElement)("span",{className:"qsa-stat-label"},(0,s.__)("Total Modules:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-stat-value"},t.totalModules)),(0,e.createElement)("div",{className:"qsa-stat-group"},(0,e.createElement)("span",{className:"qsa-stat-label"},(0,s.__)("Start Position:","qsa-engraving")),(0,e.createElement)("input",{type:"number",min:"1",max:"8",value:u,onChange:e=>{const a=parseInt(e.target.value,10);a>=1&&a<=8&&(q(a),g(t.id,a))},disabled:"pending"!==t.status,className:"qsa-start-position-input",title:(0,s.__)("Starting position on array (1-8)","qsa-engraving")})),E&&(0,e.createElement)("div",{className:"qsa-stat-group"},(0,e.createElement)("span",{className:"qsa-stat-label"},(0,s.__)("Serials:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-serial-range"},r(E.start)," - ",r(E.end)))),"in_progress"===t.status&&(0,e.createElement)("div",{className:"qsa-in-progress-details"},(0,e.createElement)("div",{className:"qsa-progress-indicator"},(0,e.createElement)("div",{className:"qsa-progress-badge"},(0,e.createElement)("span",{className:"dashicons dashicons-grid-view"}),(0,e.createElement)("span",null,(0,s.__)("Array 1 of 1","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-progress-info"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Positions:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},u," - ",Math.min(u+t.totalModules-1,8))),(0,e.createElement)("div",{className:"qsa-progress-info"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Modules:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-info-value"},t.totalModules)),E&&(0,e.createElement)("div",{className:"qsa-progress-info"},(0,e.createElement)("span",{className:"qsa-info-label"},(0,s.__)("Serials:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-serial-range-active"},r(E.start)," - ",r(E.end)))),(0,e.createElement)("div",{className:"qsa-keyboard-hint"},(0,e.createElement)("span",{className:"keyboard-key"},"SPACE"),(0,e.createElement)("span",null,(0,s.__)("Press spacebar or click Complete to finish","qsa-engraving")))))}function i(){const e=new URLSearchParams(window.location.search).get("batch_id");return e?parseInt(e,10):null}function c(){var r,c;const[o]=(0,a.useState)(i),[m,d]=(0,a.useState)(null),[g,u]=(0,a.useState)([]),[q,p]=(0,a.useState)(null),[v,_]=(0,a.useState)(!0),[E,N]=(0,a.useState)(null),[h,b]=(0,a.useState)(null),[w,f]=(0,a.useState)({enabled:null!==(r=window.qsaEngraving?.lightburnEnabled)&&void 0!==r&&r,autoLoad:null===(c=window.qsaEngraving?.lightburnAutoLoad)||void 0===c||c,connected:!1,loading:!1,lastFile:null}),y=(0,a.useCallback)(async()=>{if(!o)return N((0,s.__)("No batch ID specified.","qsa-engraving")),void _(!1);try{const e=new FormData;e.append("action","qsa_get_queue"),e.append("nonce",window.qsaEngraving?.nonce||""),e.append("batch_id",o);const a=await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}),t=await a.json();t.success?(d(t.data.batch),u(t.data.queue_items),p(t.data.capacity),N(null)):N(t.message||(0,s.__)("Failed to load queue.","qsa-engraving"))}catch(e){N((0,s.__)("Network error loading queue.","qsa-engraving"))}_(!1)},[o]);(0,a.useEffect)(()=>{y()},[y]),(0,a.useEffect)(()=>{if(g.length>0&&null===h){const e=g.find(e=>"in_progress"===e.status);e&&b(e.id)}},[g,h]),(0,a.useEffect)(()=>{const e=e=>{const a=document.activeElement,s=a?.tagName?.toLowerCase();if("input"!==s&&"textarea"!==s&&"select"!==s&&!a?.isContentEditable&&"Space"===e.code&&null!==h){e.preventDefault();const a=g.find(e=>e.id===h);a&&"in_progress"===a.status&&x(h)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h,g]);const S=async(e,a={})=>{const s=new FormData;return s.append("action",e),s.append("nonce",window.qsaEngraving?.nonce||""),s.append("batch_id",o),Object.entries(a).forEach(([e,a])=>{s.append(e,a)}),(await fetch(window.qsaEngraving?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:s})).json()},k=async(e,a=!0)=>{try{f(e=>({...e,loading:!0}));const t=await S("qsa_generate_svg",{qsa_sequence:e,auto_load:a&&w.enabled?"1":"0"});return t.success?(f(e=>({...e,loading:!1,lastFile:t.data.filename,connected:t.data.lightburn_loaded||e.connected})),{success:!0,data:t.data}):(f(e=>({...e,loading:!1})),{success:!1,error:t.message||(0,s.__)("SVG generation failed.","qsa-engraving")})}catch(e){return f(e=>({...e,loading:!1})),{success:!1,error:(0,s.__)("Network error generating SVG.","qsa-engraving")}}},C=async e=>{try{const a=await S("qsa_start_row",{qsa_sequence:e});if(a.success){if(b(e),u(s=>s.map(s=>s.id===e?{...s,status:"in_progress",serials:a.data.serials}:s)),w.enabled){const a=await k(e,w.autoLoad);a.success?a.data&&!a.data.lightburn_loaded&&w.autoLoad&&console.warn("SVG generated but LightBurn load failed:",a.data.lightburn_error):alert((0,s.__)("Row started but SVG generation failed:","qsa-engraving")+"\n\n"+a.error+"\n\n"+(0,s.__)("Please resolve the issue and use Resend to regenerate the SVG.","qsa-engraving"))}}else alert(a.message||(0,s.__)("Failed to start row.","qsa-engraving"))}catch(e){alert((0,s.__)("Network error starting row.","qsa-engraving"))}},x=async e=>{try{const a=await S("qsa_complete_row",{qsa_sequence:e});a.success?(b(null),u(a=>a.map(a=>a.id===e?{...a,status:"complete"}:a)),a.data.batch_complete&&alert((0,s.__)("Batch complete! All modules have been engraved.","qsa-engraving"))):alert(a.message||(0,s.__)("Failed to complete row.","qsa-engraving"))}catch(e){alert((0,s.__)("Network error completing row.","qsa-engraving"))}},P=async e=>{if(confirm((0,s.__)("This will void current serials and assign new ones. Continue?","qsa-engraving")))try{const a=await S("qsa_retry_array",{qsa_sequence:e});if(a.success){if(u(s=>s.map(s=>s.id===e?{...s,serials:a.data.serials}:s)),w.enabled){const a=await k(e,w.autoLoad);a.success?a.data&&!a.data.lightburn_loaded&&w.autoLoad&&console.warn("SVG regenerated but LightBurn load failed:",a.data.lightburn_error):alert((0,s.__)("Serials assigned but SVG generation failed:","qsa-engraving")+"\n\n"+a.error+"\n\n"+(0,s.__)("Please resolve the issue and use Resend to regenerate the SVG.","qsa-engraving"))}}else alert(a.message||(0,s.__)("Failed to retry.","qsa-engraving"))}catch(e){alert((0,s.__)("Network error during retry.","qsa-engraving"))}},I=async e=>{try{f(e=>({...e,loading:!0}));const a=await S("qsa_load_svg",{qsa_sequence:e});if(a.success)f(e=>({...e,loading:!1,lastFile:a.data.filename,connected:!0}));else{const a=await k(e,!0);a.success?f(e=>({...e,loading:!1})):(f(e=>({...e,loading:!1})),alert((0,s.__)("Failed to regenerate SVG:","qsa-engraving")+"\n\n"+a.error+"\n\n"+(0,s.__)("Please resolve the issue and try again.","qsa-engraving")))}}catch(e){f(e=>({...e,loading:!1})),alert((0,s.__)("Network error during resend.","qsa-engraving"))}},L=async e=>{if(confirm((0,s.__)("This will reset this row to pending for re-engraving. Continue?","qsa-engraving")))try{const a=await S("qsa_rerun_row",{qsa_sequence:e});a.success?u(a=>a.map(a=>a.id===e?{...a,status:"pending",serials:[]}:a)):alert(a.message||(0,s.__)("Failed to rerun.","qsa-engraving"))}catch(e){alert((0,s.__)("Network error during rerun.","qsa-engraving"))}},F=async(e,a)=>{try{const t=await S("qsa_update_start_position",{qsa_sequence:e,start_position:a});t.success?u(s=>s.map(s=>s.id===e?{...s,startPosition:a}:s)):alert(t.message||(0,s.__)("Failed to update start position.","qsa-engraving"))}catch(e){alert((0,s.__)("Network error updating start position.","qsa-engraving"))}},M={totalItems:g.length,completedItems:g.filter(e=>"complete"===e.status).length,totalModules:g.reduce((e,a)=>e+a.totalModules,0),completedModules:g.filter(e=>"complete"===e.status).reduce((e,a)=>e+a.totalModules,0)};return v?(0,e.createElement)("div",{className:"qsa-queue-loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,e.createElement)("p",null,(0,s.__)("Loading engraving queue...","qsa-engraving"))):E?(0,e.createElement)("div",{className:"qsa-queue-error"},(0,e.createElement)("div",{className:"notice notice-error"},(0,e.createElement)("p",null,E)),(0,e.createElement)("p",null,(0,e.createElement)("a",{href:window.location.href.replace(/&batch_id=\d+/,""),className:"button"},(0,s.__)("Go to Batch Creator","qsa-engraving")))):(0,e.createElement)("div",{className:"qsa-engraving-queue"},(0,e.createElement)(t,{batch:m}),(0,e.createElement)(n,{stats:M,capacity:q}),w.enabled&&(0,e.createElement)("div",{className:"qsa-lightburn-status "+(w.loading?"loading":"")},(0,e.createElement)("span",{className:"dashicons dashicons-admin-generic"}),(0,e.createElement)("span",{className:"qsa-lightburn-label"},(0,s.__)("LightBurn:","qsa-engraving")),w.loading?(0,e.createElement)("span",{className:"qsa-lightburn-state loading"},(0,e.createElement)("span",{className:"spinner is-active"}),(0,s.__)("Sending...","qsa-engraving")):(0,e.createElement)("span",{className:"qsa-lightburn-state ready"},(0,s.__)("Ready","qsa-engraving")),w.lastFile&&(0,e.createElement)("span",{className:"qsa-lightburn-file"},(0,e.createElement)("code",null,w.lastFile))),(0,e.createElement)("div",{className:"qsa-queue-list"},(0,e.createElement)("div",{className:"qsa-queue-list-header"},(0,e.createElement)("span",{className:"dashicons dashicons-list-view"}),(0,e.createElement)("span",{className:"qsa-queue-list-title"},(0,s.__)("Array Engraving Queue","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-queue-items"},g.map((a,s)=>(0,e.createElement)(l,{key:a.id,item:a,isLast:s===g.length-1,isActive:h===a.id,onStart:C,onComplete:x,onRetry:P,onResend:I,onRerun:L,onStartPositionChange:F})))),(0,e.createElement)("div",{className:"qsa-queue-footer"},(0,e.createElement)("div",{className:"qsa-queue-legend"},(0,e.createElement)("span",{className:"qsa-legend-title"},(0,s.__)("Group Types:","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-legend-item same-full"},(0,e.createElement)("span",{className:"qsa-legend-dot"}),(0,s.__)("Same ID x Full","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-legend-item same-partial"},(0,e.createElement)("span",{className:"qsa-legend-dot"}),(0,s.__)("Same ID x Partial","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-legend-item mixed-full"},(0,e.createElement)("span",{className:"qsa-legend-dot"}),(0,s.__)("Mixed ID x Full","qsa-engraving")),(0,e.createElement)("span",{className:"qsa-legend-item mixed-partial"},(0,e.createElement)("span",{className:"qsa-legend-dot"}),(0,s.__)("Mixed ID x Partial","qsa-engraving"))),(0,e.createElement)("div",{className:"qsa-queue-keyboard-hint"},(0,e.createElement)("span",{className:"keyboard-key"},"SPACE"),(0,e.createElement)("span",null,(0,s.__)("Complete current row","qsa-engraving")))))}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("qsa-engraving-engraving-queue");s&&(0,a.createRoot)(s).render((0,e.createElement)(c,null))})}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={exports:{}};return a[e](r,r.exports,t),r.exports}t.m=a,e=[],t.O=(a,s,n,r)=>{if(!s){var l=1/0;for(m=0;m<e.length;m++){for(var[s,n,r]=e[m],i=!0,c=0;c<s.length;c++)(!1&r||l>=r)&&Object.keys(t.O).every(e=>t.O[e](s[c]))?s.splice(c--,1):(i=!1,r<l&&(l=r));if(i){e.splice(m--,1);var o=n();void 0!==o&&(a=o)}}return a}r=r||0;for(var m=e.length;m>0&&e[m-1][2]>r;m--)e[m]=e[m-1];e[m]=[s,n,r]},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={470:0,861:0};t.O.j=a=>0===e[a];var a=(a,s)=>{var n,r,[l,i,c]=s,o=0;if(l.some(a=>0!==e[a])){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(c)var m=c(t)}for(a&&a(s);o<l.length;o++)r=l[o],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(m)},s=globalThis.webpackChunkqsa_engraving=globalThis.webpackChunkqsa_engraving||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))})();var n=t.O(void 0,[861],()=>t(601));n=t.O(n)})();